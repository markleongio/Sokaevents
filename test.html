<!DOCTYPE html>
<html>
<head><meta charset="UTF-8"><title>Debug Test</title></head>
<body style="font-family:monospace;padding:24px;background:#1a0a2e;color:#fff;font-size:13px;line-height:1.9">
<h2 style="color:#d4a843">Step-by-Step Debug</h2>
<div id="log"></div>
<script>
const DB_URL = "https://soka-d2-events-default-rtdb.asia-southeast1.firebasedatabase.app";

function log(msg, color) {
  const d = document.createElement('div');
  d.style.color = color || '#fff';
  d.textContent = '[' + new Date().toISOString().substr(11,8) + '] ' + msg;
  document.getElementById('log').appendChild(d);
}

async function run() {
  log('Step 1: fetch /app.json ...', '#fbbf24');
  try {
    const res = await fetch(DB_URL + '/app.json');
    log('Step 1 OK — status: ' + res.status, '#4ade80');

    log('Step 2: parsing JSON ...', '#fbbf24');
    const data = await res.json();
    log('Step 2 OK — data is: ' + (data === null ? 'NULL' : typeof data), '#4ade80');

    if (data) {
      log('Step 3: data.events type = ' + typeof data.events, '#fbbf24');
      log('Step 3: data.settings type = ' + typeof data.settings, '#fbbf24');

      log('Step 4: Object.values(data.events) ...', '#fbbf24');
      const events = Object.values(data.events || {});
      log('Step 4 OK — ' + events.length + ' events', '#4ade80');

      log('Step 5: appName = ' + (data.settings?.name || 'Our Events'), '#4ade80');
      log('Step 5: adminPw exists = ' + !!(data.settings?.password), '#4ade80');
    } else {
      log('Data is null — will seed on first run', '#fbbf24');
    }

    log('✅ All steps passed — hideLoading() should work', '#4ade80');
  } catch(e) {
    log('❌ ERROR at: ' + e.message, '#f87171');
    log('Stack: ' + e.stack, '#f87171');
  }
}
run();
</script>
</body>
</html>
